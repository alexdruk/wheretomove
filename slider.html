<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Multi-Parameter County Comparison</title>
    <style>
      body {
        font-family: "Helvetica Neue", "Helvetica", "Arial", sans-serif;
        font-size: 15pt;
      }
      h1,
      h2,
      h3 {
        text-align: center;
        font-weight: 500;
        color: green;
      }
      svg {
        display: block;
        margin: auto;
        border: 1px solid #eee;
      }
      #menu {
        position: relative;
        top: 90px;
        left: 50px;
      }

      #menu .item {
        margin-bottom: 12px;
        display: block;
      }

      #menu .item input {
        width: 150px;
      }

      #menu .item .value {
        font-weight: bold;
      }

      #menu .item span,
      #menu .item input {
        vertical-align: middle;
      }

      #menu .item .low {
        display: inline-block;
        width: 30px;
        text-align: right;
        font-size: smaller;
      }
      #menu .item .high {
        font-size: smaller;
      }
      .label {
        margin: auto;
        font-size: smaller;
        text-align: center;
      }
      .row {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        width: 100%;
      }

      .column {
        display: flex;
        flex-direction: column;
        flex-basis: 100%;
        flex: auto;
        align-items: center;
      }
      /* Tooltip */
      div.tooltip {
        position: absolute;
        visibility: hidden;
        font-size: 60%;
        color: #333333;
        background-color: #e6e6e6;
        opacity: 0.95;
        padding: 5px;
      }
      .cardcontainer {
        align-items: center;
        justify-content: center;
        margin-top: 50px;
        margin-left: auto;
        margin-right: auto;
        display: flex;
        flex-wrap: wrap;
        width: 80%;
      }
      .card {
        /* Add shadows to create the "card" effect */
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        transition: 0.3s;
        padding: 2px 16px;
        font-size: smaller;
        width: 100%;
        margin-bottom: 10px;
      }

      /* On mouse-over, add a deeper shadow */
      .card:hover {
        box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2);
      }

      .source {
        font-style: italic;
        font-size: small;
        margin-left: 10px;
      }
      h4 {
        margin-top: 0;
        margin-bottom: 0;
        margin-left: 0px;
      }
      p {
        margin-top: 2px;
        margin-bottom: 2px;
      }
      .remove {
        background-color: #faf1f1;
      }
      .addbutton {
        background-color: #ecfaed;
        white-space: nowrap;
      }
      .slider {
        overflow-x: auto;
      }
      /* Responsive layout - makes the two columns stack on top of each other instead of next to each other */
      @media only screen and (max-width: 1000px) {
        .row {
          /* it place the items in vertical direction */
          flex-direction: column;
        }
        .column {
          width: 100%;
        }
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/topojson-client@3.1.0/dist/topojson-client.min.js"></script>
  </head>
  <body>
    <h1>Good County - Bad County</h1>
    <h2>Multi-Parameter County Comparison and Mapping</h2>
    <div class="row">
      <div class="column">
        <div id="menu">
          <div class="slider item" id="stormSlider" style="display: none">
            <div class="label">
              Storms (<span class="val" id="stormVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('storm')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="storm"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="droughtSlider" style="display: none">
            <div class="label">
              Drought (<span class="val" id="droughtVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('drought')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="drought"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="firesSlider" style="display: none">
            <div class="label">
              Wild Fires (<span class="val" id="firesVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('fires')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="fires"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="heatwavesSlider" style="display: none">
            <div class="label">
              Heat Waves (<span class="val" id="heatwavesVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('heatwaves')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="heatwaves"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="floodSlider" style="display: none">
            <div class="label">
              Floods (<span class="val" id="floodVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('flood')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="flood"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="sunshineSlider" style="display: none">
            <div class="label">
              Sunshine (<span class="val" id="sunshineVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('sunshine')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="sunshine"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="temperatureSlider" style="display: none">
            <div class="label">
              Temperature Anomalies (<span class="val" id="temperatureVal"
                >5</span
              >)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('temperature')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="temperature"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div
            class="slider item"
            id="precipitationSlider"
            style="display: none"
          >
            <div class="label">
              Precipitation Anomalies (<span class="val" id="precipitationVal"
                >5</span
              >)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('precipitation')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="precipitation"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="airSlider" style="display: none">
            <div class="label">
              Air Quality (<span class="val" id="airVal">5</span>)
            </div>
            <div>
              <button class="remove" type="button" onClick="removeById('air')">
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="air"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="taxesSlider" style="display: none">
            <div class="label">
              Taxes (<span class="val" id="taxesVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('taxes')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="taxes"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="livingSlider" style="display: none">
            <div class="label">
              Cost of living (<span class="val" id="livingVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('living')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="living"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="eduSlider" style="display: none">
            <div class="label">
              Education (<span class="val" id="eduVal">5</span>)
            </div>
            <div>
              <button class="remove" type="button" onClick="removeById('edu')">
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="edu"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="crimeSlider" style="display: none">
            <div class="label">
              Crime (<span class="val" id="crimeVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('crime')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="crime"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="homeSlider" style="display: none">
            <div class="label">
              Home Prices (<span class="val" id="homeVal">5</span>)
            </div>
            <div>
              <button class="remove" type="button" onClick="removeById('home')">
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="home"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="rentSlider" style="display: none">
            <div class="label">
              Rent (<span class="val" id="rentVal">5</span>)
            </div>
            <div>
              <button class="remove" type="button" onClick="removeById('rent')">
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="rent"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="employSlider" style="display: none">
            <div class="label">
              Rate of Employment (<span class="val" id="employVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('employ')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="employ"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="doctorsSlider" style="display: none">
            <div class="label">
              Doctors availability (<span class="val" id="doctorsVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('doctors')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="doctors"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="mortalitySlider" style="display: none">
            <div class="label">
              Mortality (<span class="val" id="mortalityVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('mortality')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="mortality"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="amenitiesSlider" style="display: none">
            <div class="label">
              Natural Amenities (<span class="val" id="amenitiesVal">5</span>)
            </div>
            <div>
              <button
                class="remove"
                type="button"
                onClick="removeById('amenities')"
              >
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="amenities"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
          <div class="slider item" id="farSlider" style="display: none">
            <div class="label">
              Frontier and Remote Area (<span class="val" id="farVal">5</span>)
            </div>
            <div>
              <button class="remove" type="button" onClick="removeById('far')">
                <span> &#215; </span>
              </button>
              <span class="low">1</span>
              <input
                type="range"
                min="1"
                max="10"
                value="5"
                class="slider"
                id="far"
                onchange="changeColor()"
              />
              <span class="high">10</span>
            </div>
          </div>
          <!--- end of slider -->
        </div>
        <!-- end of menu -->
      </div>
      <!-- end of column -->
      <div class="column" style="margin-left: 30px">&nbsp;&nbsp;</div>
      <div class="column" style="margin-top: 80px">
        <div id="map"></div>
        <!--div class="tooltip"></div-->
      </div>
      <!-- end of column -->
    </div>
    <!-- end of row -->
    <h3>Add Parameter</h3>
    <div class="cardcontainer">
      <div class="row">
        <div class="card" id="stormLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('storm')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Storm Events</h4>
                <p>Number of Storm Events (2001-2021)</p>
                <p class="source">
                  Source:
                  <a href="https://www.ncdc.noaa.gov/stormevents/ftp.jsp"
                    >NOAA's National Weather Service (NWS)</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="droughtLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('drought')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Weeks in Drought</h4>
                <p>
                  Total Weeks in Drought (2015-2021) with severe, extreme and
                  exceptional drought
                </p>
                <p class="comments">
                  Severe Drought: Crop or pasture losses likely; Water shortages
                  common; Water restrictions imposed.
                </p>
                <p>
                  Extreme Drought: Major crop/pasture losses; Widespread water
                  shortages or restrictions.
                </p>
                <p>
                  Exceptional Drought: Exceptional and widespread crop/pasture
                  losses; Shortages of water in reservoirs, streams, and wells
                  creating water emergencies.
                </p>
                <p class="source">
                  Source:
                  <a
                    href="from https://droughtmonitor.unl.edu/DmData/DataDownload/WeeksInDrought.aspx"
                    >U.S. Drought Monitor</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="firesLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('fires')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Wild Fires</h4>
                <p>Number of Wild Fires (2015-2021)</p>
                <p class="source">
                  Source:
                  <a
                    href="https://data-nifc.opendata.arcgis.com/datasets/nifc::wfigs-wildland-fire-locations-full-history/about"
                    >National Interagency Fire Center (WFIGS)</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="heatwavesLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('heatwaves')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Heat Waves</h4>
                <p>Number of heat wave days in May-September (1981-2010)</p>
                <p class="source">
                  Source:
                  <a
                    href="https://wonder.cdc.gov/NCA-heatwavedays-historic.html"
                    >CDC WONDER</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="floodLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('flood')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Floods</h4>
                <p>Properties at Risk of Floods at 2035, %</p>
                <p class="source">
                  Source:
                  <a href="https://floodfactor.com/">Flood Factor</a>
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="sunshineLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('sunshine')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Sunshine</h4>
                <p>
                  Cummulative daily sunlight (1979-2011), deviation from
                  average, % of maximum
                </p>
                <p class="comments">(Not too little, not too much)</p>
                <p class="source">
                  Source:
                  <a href="http://wonder.cdc.gov/NASA-INSOLAR.html"
                    >North America Land Data Assimilation System (NLDAS) Daily
                    Sunlight (insolation) for years 1991-2011 on CDC</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="temperatureLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('temperature')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Temperature Anomalities</h4>
                <p>Average temperature anomalities (2001-2020)</p>
                <p class="source">
                  Source:
                  <a
                    href="https://www.ncdc.noaa.gov/cag/county/mapping/110/tavg/200112/12/value"
                    >NOAA National Centers for Environmental information,
                    Climate at a Glance: National Time Series</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="precipitationLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('precipitation')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Precipitation Anomalies</h4>
                <p>Average precipitation anomalities (2001-2020)</p>
                <p class="source">
                  Source:
                  <a
                    href="https://www.ncdc.noaa.gov/cag/county/mapping/110/tavg/200112/12/value"
                    >NOAA National Centers for Environmental information,
                    Climate at a Glance: National Time Series</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="airLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('air')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Air Quality</h4>
                <p>
                  Total Unhealthy for Sensitive Groups Days, Unhealthy Days,
                  Very Unhealthy Days and Hazardous Days (2020)
                </p>
                <p class="source">
                  Source:
                  <a href="https://www3.epa.gov/aircompare/"
                    >U.S. Environmental Protection Agency. AirCompare.
                  </a>
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="taxesLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('taxes')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Taxes</h4>
                <p>Local and state taxation, %</p>
                <p class="comments">(from low to high)</p>
                <p class="source">
                  Source:
                  <a href="https://www.census.gov/programs-surveys/stc.html"
                    >U.S. Census Bureau</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="livingLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('living')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Cost of Living</h4>
                <p class="comments">
                  (From low to high, data is approximation only)
                </p>
                <p class="source">
                  Source:
                  <a href="http://niche.com">niche.com</a>
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="eduLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('edu')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Education</h4>
                <p>Ranking of Educational districts</p>
                <p class="source">
                  Source:
                  <a href="http://niche.com">niche.com</a>
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="homeLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('home')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Home Prices</h4>
                <p>Median Value of Owner-Occupied Housing Units</p>
                <p class="comments">(From low to high)</p>
                <p class="source">
                  Source:
                  <a href="https://www.census.gov/quickfacts"
                    >U.S. Census Bureau</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="rentLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('rent')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Rent</h4>
                <p>Median Gross Rent</p>
                <p class="comments">(From low to high)</p>
                <p class="source">
                  Source:
                  <a href="https://www.census.gov/quickfacts"
                    >U.S. Census Bureau</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="employmentLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('employment')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Rate of Employment</h4>
                <p>Employment Rate per 100,000 of population</p>
                <p class="source">
                  Source:
                  <a href="https://www.bls.gov/web/cewdat.supp.toc.htm"
                    >U.S. Bureau of Labor Statistics</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="doctorsLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('doctors')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Doctors availability</h4>
                <p>All M.D. per 100,000 population</p>
                <p class="source">
                  Source:
                  <a href="https://data.hrsa.gov/topics/health-workforce/ahrf"
                    >Health Resources & Services Administration</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="mortalityLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('mortality')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Mortality</h4>
                <p>Mortality per population counts 1999 to 2016, %</p>
                <p class="comments">(Not too little, not too much)</p>
                <p class="source">
                  Source:
                  <a href="https://wonder.cdc.gov/controller/datarequest/D140">
                    Centers for Disease Control and Prevention (CDC), National
                    Center for Health Statistics (NCHS), Compressed Mortality
                    File (CMF) on CDC WONDER Online Database.</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="amenitiesLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('amenities')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Natural Amenities Scale</h4>
                <p>
                  The natural amenities scale is a measure of the physical
                  characteristics of a county area that enhance the location as
                  a place to live. The scale was constructed by combining six
                  measures of climate, topography, and water area that reflect
                  environmental qualities most people prefer.
                </p>
                <p class="source">
                  Source:
                  <a
                    href="https://www.ers.usda.gov/data-products/natural-amenities-scale/"
                    >USDA Economic Research Service</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
      <div class="row">
        <div class="card" id="farLine">
          <table>
            <tr>
              <td style="padding: 10px">
                <button
                  type="button"
                  class="addbutton"
                  onClick="addById('far')"
                >
                  <span>&#43; add</span>
                </button>
              </td>
              <td>
                <h4>Frontier and Remote Areas</h4>
                <p>
                  The term "frontier and remote" is used here to describe
                  territory characterized by some combination of low population
                  size and high geographic remoteness. FAR areas are defined in
                  relation to the time it takes to travel by car to the edges of
                  nearby Urban Areas (UAs).
                </p>
                <p class="source">
                  Source:
                  <a
                    href="https://www.ers.usda.gov/data-products/frontier-and-remote-area-codes/"
                    >USDA Economic Research Service</a
                  >
                </p>
              </td>
            </tr>
          </table>
        </div>
      </div>
      <!-- end of row -->
    </div>
    <script>
      // Copyright 2021 Observable, Inc.
      // Released under the ISC license.
      // https://observablehq.com/@d3/choropleth
      let data, us;
      const range = d3.schemeGreens[9];
      async function getDataFromFiles() {
        [data, us] = await Promise.all([
          d3.csv("final.csv"),
          d3.json("counties-albers-10m.json"),
        ]);
        excludeAlaska();
      }
      async function ready() {
        await getDataFromFiles();
        // document.getElementById("map").innerHTML = "";
        const newData = processInputs(data);
        // console.table(sortDataDesc(data, "result"));
        const counties = topojson.feature(us, us.objects.counties);
        const statemap = new Map(
          topojson.feature(us, us.objects.states).features.map((d) => [d.id, d])
        );
        const statemesh = topojson.mesh(
          us,
          us.objects.states,
          (a, b) => a !== b
        );
        // const range = d3.schemeGreens[9];
        // const scale = d3.Sequential;
        const scale = d3.scaleQuantize;
        const domain = [0, getInputs().length]; // should be number of questions
        // const domain = [0, 10]; // should be number of questions

        Choropleth(newData, {
          id: (d) => d.fips_id,
          value: (d) => d.result,
          scale: scale,
          domain: domain,
          range: range,
          title: (f, d) =>
            `${f.properties.name}, ${
              statemap.get(f.id.slice(0, 2)).properties.name
            }`,
          features: counties,
          borders: statemesh,
          //   county_borders: counties,
          width: 975,
          height: 610,
        });
        // Legend(scale(domain, range), {
        //   title: "Unemployment rank (%)",
        // });

        function Choropleth(
          newData,
          {
            id = (d) => d.id, // given d in data, returns the feature id
            value = () => undefined, // given d in data, returns the quantitative value
            title, // given a feature f and possibly a datum d, returns the hover text
            format, // optional format specifier for the title
            // scale = d3.scaleSequential, // type of color scale
            scale = d3.scaleQuantize, // type of color scale
            domain, // [min, max] values; input of color scale
            range = d3.interpolateGreens, // output of color scale
            // width = 640, // outer width, in pixels
            width = 975, // outer width, in pixels
            height, // outer height, in pixels
            projection, // a D3 projection; null for pre-projected geometry
            features, // a GeoJSON feature collection
            featureId = (d) => d.id, // given a feature, returns its id
            borders, // a GeoJSON object for stroking borders
            county_borders, // a GeoJSON object for stroking county borders
            outline = projection && projection.rotate
              ? { type: "Sphere" }
              : null, // a GeoJSON object for the background
            unknown = "#ccc", // fill color for missing data
            fill = "white", // fill color for outline
            stroke = "white", // stroke color for borders
            strokeLinecap = "round", // stroke line cap for borders
            strokeLinejoin = "round", // stroke line join for borders
            strokeWidth, // stroke width for borders
            strokeOpacity, // stroke opacity for borders
          } = {}
        ) {
          const zoom = d3.zoom().scaleExtent([1, 2]).on("zoom", zoomed);

          // Compute values.
          const N = d3.map(data, id);
          const V = d3.map(data, value).map((d) => (d == null ? NaN : +d));
          const Im = new d3.InternMap(N.map((id, i) => [id, i]));
          const If = d3.map(features.features, featureId);

          // Compute default domains.
          if (domain === undefined) domain = d3.extent(V);

          // Construct scales.
          // const color = d3.scaleLinear(domain, range);
          const color = scale(domain, range);
          if (unknown !== undefined) color.unknown(unknown);

          // Compute titles.
          if (title !== null) {
            const T = title;
            const O = d3.map(data, (d) => d);
            title = (f, i) => T(f, O[i]);
          }

          // Compute the default height. If an outline object is specified, scale the projection to fit
          // the width, and then compute the corresponding height.
          if (height === undefined) {
            if (outline === undefined) {
              height = 400;
            } else {
              const [[x0, y0], [x1, y1]] = d3
                .geoPath(projection.fitWidth(width, outline))
                .bounds(outline);
              const dy = Math.ceil(y1 - y0),
                l = Math.min(Math.ceil(x1 - x0), dy);
              projection
                .scale((projection.scale() * (l - 1)) / l)
                .precision(0.2);
              height = dy;
            }
          }

          // Construct a path generator.
          const path = d3.geoPath(projection);

          const svg = d3
            .select("#map")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .attr("viewBox", [0, 0, width, height])
            .attr("style", "max-width: 100%; height: auto; height: intrinsic;")
            .on("click", reset);

          const g = svg.append("g");

          // svg
          //   .append("g")
          //   .selectAll("path")
          //   .data(features.features)
          //   .join("path")
          //   .attr("fill", (d, i) => color(V[Im.get(If[i])]))
          //   .attr("id", (d) => "county" + d.id)
          //   .attr("d", path)
          //   // .attr("stroke", "#bfbfbf")
          //   // .attr("stroke-width", 0.6)
          //   // .attr("stroke-linejoin", "round")
          //   .append("title")
          //   .text((d, i) => title(d, Im.get(If[i])));

          const counties = g
            .append("g")
            .selectAll("path")
            .data(features.features)
            .join("path")
            .attr("fill", (d, i) => color(V[Im.get(If[i])]))
            .attr("id", (d) => "county" + d.id)
            .attr("d", path)
            .attr("stroke", "#bfbfbf")
            .attr("stroke-width", 0.6)
            .attr("stroke-linejoin", "round");
          // .append("title")
          // .text((d, i) => title(d, Im.get(If[i])));

          const states = g
            .append("g")
            .attr("fill", "transparent")
            .attr("cursor", "pointer")
            .selectAll("path")
            .data(topojson.feature(us, us.objects.states).features)
            .join("path")
            .on("click", clicked)
            .attr("stroke", "black")
            .attr("stroke-linecap", strokeLinecap)
            .attr("stroke-linejoin", strokeLinejoin)
            .attr("stroke-width", 0.8)
            .attr("d", path);

          // create a tooltip
          // var tooltip = d3
          //   .select("#map")
          //   .append("div")
          //   .attr("class", "tooltip")
          //   .style("position", "absolute")
          //   .style("visibility", "hidden");
          // // .text("I'm a circle!");

          // //
          // data.forEach(function (d) {
          //   tooltip.innerHTML = d.county;
          //   let selectedCounty = document.getElementById("county" + d.fips_id);
          //   // .select(".div.tooltip")
          //   selectedCounty.onmouseover = function () {
          //     console.log(tooltip.innerHTML);
          //     return tooltip.style("visibility", "visibile");
          //   };
          //   // .on("mouseover", function () {
          //   //   return tooltip.style("visibility", "visibile");
          //   // })
          //   // .on("mouseout", function () {
          //   //   return tooltip.style("visibility", "hidden");
          //   // });
          //   // console.log(tooltip.innerHTML);
          // });

          let cl = 0;

          svg.call(zoom).on("wheel.zoom", null).on("dblclick.zoom", null);
          // svg.call(zoom);

          function reset() {
            states.transition().style("stroke", null);
            svg
              .transition()
              .duration(750)
              .call(
                zoom.transform,
                d3.zoomIdentity,
                d3.zoomTransform(svg.node()).invert([width / 2, height / 2])
              );
          }

          function clicked(event, d) {
            cl = cl + event.detail;
            const [[x0, y0], [x1, y1]] = path.bounds(d);
            event.stopPropagation();
            states.transition().style("stroke", null);
            d3.select(this).raise();
            if (cl % 2 == 0) {
              reset();
            } else {
              svg
                .transition()
                .duration(750)
                .call(
                  zoom.transform,
                  d3.zoomIdentity
                    .translate(width / 2, height / 2)
                    .scale(
                      Math.min(
                        8,
                        0.9 / Math.max((x1 - x0) / width, (y1 - y0) / height)
                      )
                    )
                    .translate(-(x0 + x1) / 2, -(y0 + y1) / 2),
                  d3.pointer(event, svg.node())
                );
            } //not even
          }

          function zoomed(event) {
            const { transform } = event;
            g.attr("transform", transform);
            counties.attr("stroke-width", 0.6 * Math.sqrt(1 / transform.k));
            states.attr("stroke-width", Math.sqrt(1 / transform.k));
          }

          svg.node();
        }
      } //ready
      ready();

      function processInputs(data) {
        let inputs = getInputs();
        const columnNames = Object.keys(data[0]);
        // set result to 0
        for (let i = 0; i < data.length; ++i) {
          data[i].result = 0;
        }
        // console.table(data);
        for (let i = 3; i < columnNames.length - 1; i++) {
          // skip result
          let carrentInput = inputs.find(
            (inputs) => inputs.id === columnNames[i]
          );
          if (!carrentInput) {
            continue;
          }
          let sortedData = sortDataDesc(data, carrentInput.id);
          let slicedData = [];
          if (carrentInput.val < 2) {
            slicedData = sortedData;
          } else {
            slicedData = sortedData.slice(
              0,
              Math.round(sortedData.length * (1 - carrentInput.val / 10) + 100)
            );
          }
          for (let ind = 0; ind < slicedData.length; ind++) {
            for (let j = 0; j < data.length; ++j) {
              if (data[j].fips_id === slicedData[ind].fips_id) {
                data[j].result += parseInt(slicedData[ind][carrentInput.id]);
              }
            }
          }
        } //for
        for (let i = 0; i < data.length; ++i) {
          data[i].result = Math.round(data[i].result / inputs.length);
        }
        // console.table(sortedResults);
        return data;
      } // end processInputs()

      function getInputs() {
        let inputsVals = [];
        let inputsHTMLcollection = document.querySelectorAll(
          "input[type = range]"
        );
        //filter only visible inputs
        let inputs = Array.from(inputsHTMLcollection).filter(
          (x) => x.offsetWidth !== 0 || x.offsetHeight !== 0
        );
        for (let i = 0; i < inputs.length; ++i) {
          let id = inputs[i].id;
          let val = inputs[i].value;
          let labelId = id + "Val";
          document.getElementById(labelId).innerHTML = val;
          inputsVals.push({ id: id, val: val });
        }
        return inputsVals;
      } //getInputs

      async function changeColor() {
        processInputs(data);
        let maxResult = sortDataDesc(data, "result")[0].result;
        // console.table(sortedResults);
        let treshold = maxResult / range.length; //range.length = 9
        // console.log("treshold", treshold, data.length, range.length);
        for (let i = 0; i < data.length; ++i) {
          let elem = document.getElementById("county" + data[i].fips_id);
          if (elem) {
            if (data[i].result < treshold) {
              elem.style.fill = range[0];
            } else if (
              (data[i].result < 2 * treshold) &
              (data[i].result >= treshold)
            ) {
              elem.style.fill = range[1];
            } else if (
              (data[i].result < 3 * treshold) &
              (data[i].result >= 2 * treshold)
            ) {
              elem.style.fill = range[2];
            } else if (
              (data[i].result < 4 * treshold) &
              (data[i].result >= 3 * treshold)
            ) {
              elem.style.fill = range[3];
            } else if (
              (data[i].result < 5 * treshold) &
              (data[i].result >= 4 * treshold)
            ) {
              elem.style.fill = range[4];
            } else if (
              (data[i].result < 6 * treshold) &
              (data[i].result >= 5 * treshold)
            ) {
              elem.style.fill = range[5];
            } else if (
              (data[i].result < 7 * treshold) &
              (data[i].result >= 6 * treshold)
            ) {
              elem.style.fill = range[6];
            } else if (
              (data[i].result < 8 * treshold) &
              (data[i].result >= 7 * treshold)
            ) {
              elem.style.fill = range[7];
            } else if (
              (data[i].result <= 9 * treshold) &
              (data[i].result >= 8 * treshold)
            ) {
              elem.style.fill = range[8];
            } else {
              elem.style.fill = null;
            }
            // if (isNaN(sortedResults[sortedResults.length - 1].result)) {
            //   elem.style.fill = null;
            // }
          } else {
            console.log("elem not found");
          }
        }
      } // end changeColor()
      function removeById(id) {
        let sliderid = id + "Slider";
        let elem = document.getElementById(sliderid);
        elem.style.display = "none";
        let lineId = id + "Line";
        let lineElem = document.getElementById(lineId);
        lineElem.style.display = "block";
        changeColor();
      }
      function addById(id) {
        let sliderid = id + "Slider";
        let elem = document.getElementById(sliderid);
        elem.style.display = "block";
        let lineId = id + "Line";
        let lineElem = document.getElementById(lineId);
        lineElem.style.display = "none";
        changeColor();
      }
      function sortDataAsc(data, key) {
        return data.sort((a, b) => a[key] - b[key]);
      } //end sortData
      function sortDataDesc(data, key) {
        return data.sort((a, b) => b[key] - a[key]);
      } //end sortData
      function excludeAlaska() {
        const AlaskaHawaiiFips = [
          "02013",
          "02016",
          "02020",
          "02050",
          "02060",
          "02068",
          "02070",
          "02090",
          "02100",
          "02105",
          "02110",
          "02122",
          "02130",
          "02150",
          "02158",
          "02164",
          "02170",
          "02180",
          "02185",
          "02188",
          "02195",
          "02198",
          "02220",
          "02230",
          "02240",
          "02261",
          "02270",
          "02275",
          "02282",
          "02290",
          "15001",
          "15003",
          "15005",
          "15007",
          "15009",
        ];
        const AlaskaHawaiiStateFips = ["02", "15"];
        us.objects.counties.geometries = us.objects.counties.geometries.filter(
          function (d) {
            return AlaskaHawaiiFips.indexOf(d.id) == -1;
          }
        );
        us.objects.states.geometries = us.objects.states.geometries.filter(
          function (d) {
            return AlaskaHawaiiStateFips.indexOf(d.id) == -1;
          }
        );
      }
    </script>
  </body>
</html>
